This repository contains all codes and relevant resources used in the manuscript "Peri-urban vegetation change-induced evapotranspiration brings about urban precipitation variability". The entire analytical workflow consists of four sequential steps, followed by a series of analysis added during revision.

Step 1: Trend Analysis and Placebo Test
Main script:Step1_compute_Pur_LAIperi_Trends_PlaceboTest.m
Purpose:
Calculates linear trends and significance (p-values) of annual urban precipitation (Pur; Fig. 1b) and peri-urban LAI (LAIperi; Fig. 1c) from 2000 to 2021.
Performs placebo tests (Fig.1d) to assess the empirical significance of LAIperi–Pur linkages using 1,000 randomized permutations.
Output:
Excel files containing trend estimates and associated p-values, and figures showing the results of the placebo tests.


Step 2: ET Modeling and Vegetation change-induced ET variability
The Step2 directory contains one main script and two subfolders.
① Step2_PTJPLim_Model/
Contains MATLAB implementation of the improved Priestley–Taylor Jet Propulsion Laboratory model (PT-JPLim) used to estimate evapotranspiration (ET). ET components estimated: Interception evaporation (Ei), soil evaporation (Es), transpiration (Et),  and urban evaporation (Eu)
This folder includes:
ReadMe.txt: Description of model structure and input requirements
Step2_PTJPLim_Model_calcu_Ei.m: Interception evaporation (Ei)
Step2_PTJPLim_Model_calcu_Es.m: Soil evaporation (Es)
Step2_PTJPLim_Model_calcu_Eu.m: Urban evaporation (Eu)
Step2_PTJPLim_Model_calcu_ETall.m: Total ET aggregation

② Step2_Results_deltaETperi/
Contains annual vegetation change-induced ET variability in peri-urban areas (ΔETperi) for each year from 2000 to 2021 (e.g., deltaETperi2000.xls to deltaETperi2021.xls). ΔETperi is calculated as the difference between real- and fixed-vegetation scenarios using ArcGIS Zonal Statistics.

③ Step2_compute_deltaETperi_Trends.m
Converts PT-JPLim ET results to 0.05° spatial resolution (Fig.2a).
Computes temporal trends and associated p-values of ΔETperi (Fig.2b).
Output:
Excel files summarizing annual ΔETperi values, their linear trends, and  associated p-values.


Step 3: Moisture Transport via UTrack Model
Input references:
city_latlon.xlsx: Latitude and longitude of 1,029 cities
Step3_ID_ORIG.xlsx: Mapping between city IDs and peri-urban area IDs

① Step3_UtrackModel_annual.py
Processes city-specific12-month climatology files to compute annual average source contributions of precipitation.

② Step3_UtrackModel_monthly.py
Similar to above but retains monthly resolution for temporal analysis.

③ Step3_UtrackModel_resample.py
Resamples UTrack outputs from 0.5° to 0.05° spatial resolution using bilinear interpolation.
Performs normalization to conserve total moisture contribution.

④ Step3_compute_deltaPur_Trends_RPR_RPR_T.m
Uses UTrack model outputs to compute city-level precipitation response indicators, including:
ΔPur: Precipitation change attributed to vegetation change-induced ET and moisture transport (Fig. 3a)
Trends and associated p-values of ΔPur (Fig. 3b)
RPR: Normalized ΔPur as % of baseline precipitation (Fig. 3c)
RPR-T: Trend scale RPR, contribution of vegetation change-induced precipitation change trend to total precipitation trend (Fig. 3d)
Output:
Excel files containing city-level precipitation reponse indicators, their trends, and associated p-values.


Step 4: Urban Classification and Category-based Analysis Analysis
① compute_ΔLAI-wind direction coherence.py
Quantifies the directional alignment between the dominant axis of peri-urban vegetation change (ΔLAI) and prevailing wind direction.

② compute_Vegetation structure continuity.py
Computes vegetation structure continuity using a connectivity index derived from LAI spatial patterns.

③ Step4_Groups_RPR_RPR-T.xlsx
Records the classification of all cities into ten categories based on ΔLAI–wind coherence, vegetation structure, and resulting RPR (RPR-T) metrics.
Fields include:
City ID, RPR, RPR(Fig.4f), RPR-T, RPR-T(Fig.4f), and classification category.

④ Step4_compute_City_group_tests.m
Conducts group-wise statistical tests for RPR and RPR-T across different city types.
Output:
Summary statistics written to Excel (used for Fig. 4 panels).


Revision-added Analysis: Causal Direction, CO₂-Separated Controls, and Temporal Patterns
· · · Temporal Dynamics and Lag Analyses
① Five-year moving correlation analysis.py
Evaluates the temporal robustness of the coupling between LAIperi and Pur using a five-year moving correlation window.
② Lag analysis.py
Examines the temporal response and potential delay between changes in Pur and LAIperi through a lag analysis.

· · · Causal Direction Analysis
③ CausalDirection Analysis_Transfer Entropy.py
Computes Transfer Entropy (TE) to quantify the directional information flow between LAIperi and Pur across 1,029 cities.
④ Causal‐Direction Analysis_ Panel Granger causality test.py
Performs a panel Granger causalitytest to statistically evaluate the causal direction  between LAIperi and Pur across 1,029 cities.

· · · CO₂-Separated Statistical Controls
⑤ CO₂-separated statistical controls.py
Separates the vegetation–precipitation linkage from the potential confounding influence of rising atmospheric CO₂ concentrations. This script conducts several statistical analyses, including Pearson correlation, partial correlation (with atmospheric CO₂ as a control variable), and standardized β coefficient analysis.


System Requirements
MATLAB R2021a or later
Python 3.8+ with xarray, numpy, netCDF4, scipy
ArcGIS Pro (for Zonal Statistics)
Microsoft Excel (for result exports and integration)

Reproducibility Note
All scripts are annotated with detailed comments and structured to allow modular execution. Intermediate and final outputs are provided in each folder for validation and visualization.
*For questions or issues, please contact the corresponding author.*